# Developer — Development-oriented profile for gleisner-in-gleisner
#
# Named to reflect its purpose: working on code inside a sandbox.
# Allows access to the Rust toolchain, cargo registry, and crates.io
# while keeping credential isolation and network filtering active.
#
# Network: Anthropic API + crates.io + GitHub (filtered via nftables)
# Filesystem: System paths read-only, dev toolchain read-write, credentials hidden
# Process: PID namespace isolated, limits raised for cargo builds

name = "developer"
description = "Development profile — Rust toolchain, crates.io, GitHub access, credentials hidden"

[filesystem]
readonly_bind = [
    "/usr",
    "/lib",
    "/lib64",
    "/etc",
    "/bin",
    "/sbin",
    "/opt",
    "~/.config/gh",
]
readwrite_bind = [
    "~/.cargo",
    "~/.rustup",
    "~/.cache",
]
deny = [
    "~/.ssh",
    "~/.aws",
    "~/.gnupg",
    "~/.config/gcloud",
    "~/.azure",
    "~/.kube",
    "~/.docker",
]
tmpfs = ["/tmp"]

[network]
default = "deny"
allow_domains = [
    "api.anthropic.com",
    "sentry.io",
    "statsig.anthropic.com",
    "crates.io",
    "static.crates.io",
    "index.crates.io",
    "github.com",
    "api.github.com",
    "objects.githubusercontent.com",
    "raw.githubusercontent.com",
    # Sigstore keyless signing (Fulcio + Rekor + OIDC)
    "fulcio.sigstore.dev",
    "rekor.sigstore.dev",
    "oauth2.sigstore.dev",
    "tuf-repo-cdn.sigstore.dev",
    "sigstore.dev",
]
allow_ports = [443, 80]
allow_dns = true

[process]
pid_namespace = true
no_new_privileges = true
command_allowlist = []

[resources]
max_memory_mb = 16384
max_cpu_percent = 100
max_pids = 1024
max_file_descriptors = 4096
max_disk_write_mb = 20480

[plugins]
skip_permissions = true
add_dirs = ["~/.claude/exo-self"]
disallowed_tools = [
    # Serena: block shell/file escape vectors (keep analysis tools)
    "mcp__plugin_serena_serena__execute_shell_command",
    "mcp__plugin_serena_serena__create_text_file",
    # Playwright: entire browser automation suite — network escape vector
    "mcp__plugin_playwright_playwright__browser_close",
    "mcp__plugin_playwright_playwright__browser_resize",
    "mcp__plugin_playwright_playwright__browser_console_messages",
    "mcp__plugin_playwright_playwright__browser_handle_dialog",
    "mcp__plugin_playwright_playwright__browser_evaluate",
    "mcp__plugin_playwright_playwright__browser_file_upload",
    "mcp__plugin_playwright_playwright__browser_fill_form",
    "mcp__plugin_playwright_playwright__browser_install",
    "mcp__plugin_playwright_playwright__browser_press_key",
    "mcp__plugin_playwright_playwright__browser_type",
    "mcp__plugin_playwright_playwright__browser_navigate",
    "mcp__plugin_playwright_playwright__browser_navigate_back",
    "mcp__plugin_playwright_playwright__browser_network_requests",
    "mcp__plugin_playwright_playwright__browser_run_code",
    "mcp__plugin_playwright_playwright__browser_take_screenshot",
    "mcp__plugin_playwright_playwright__browser_snapshot",
    "mcp__plugin_playwright_playwright__browser_click",
    "mcp__plugin_playwright_playwright__browser_drag",
    "mcp__plugin_playwright_playwright__browser_hover",
    "mcp__plugin_playwright_playwright__browser_select_option",
    "mcp__plugin_playwright_playwright__browser_tabs",
    "mcp__plugin_playwright_playwright__browser_wait_for",
    # Greptile: code review service — not needed for g-in-g development
    "mcp__plugin_greptile_greptile__list_custom_context",
    "mcp__plugin_greptile_greptile__get_custom_context",
    "mcp__plugin_greptile_greptile__search_custom_context",
    "mcp__plugin_greptile_greptile__list_merge_requests",
    "mcp__plugin_greptile_greptile__list_pull_requests",
    "mcp__plugin_greptile_greptile__get_merge_request",
    "mcp__plugin_greptile_greptile__list_merge_request_comments",
    "mcp__plugin_greptile_greptile__list_code_reviews",
    "mcp__plugin_greptile_greptile__get_code_review",
    "mcp__plugin_greptile_greptile__trigger_code_review",
    "mcp__plugin_greptile_greptile__search_greptile_comments",
    "mcp__plugin_greptile_greptile__create_custom_context",
]
mcp_network_domains = [
    "context7.com",
    "api.greptile.com",
]
